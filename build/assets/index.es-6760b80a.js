import{e as Q,_ as W}from"./index-37949774.js";import{f as x,a as z}from"./index.es-68166bdb.js";import{s as B,a as K,d as Y}from"./http-b0d4482c.js";var u={};Object.defineProperty(u,"__esModule",{value:!0});u.getLocalStorage=u.getLocalStorageOrThrow=u.getCrypto=u.getCryptoOrThrow=u.getLocation=u.getLocationOrThrow=u.getNavigator=u.getNavigatorOrThrow=u.getDocument=u.getDocumentOrThrow=u.getFromWindowOrThrow=u.getFromWindow=void 0;function N(o){let e;return typeof window<"u"&&typeof window[o]<"u"&&(e=window[o]),e}u.getFromWindow=N;function b(o){const e=N(o);if(!e)throw new Error(`${o} is not defined in Window`);return e}u.getFromWindowOrThrow=b;function G(){return b("document")}u.getDocumentOrThrow=G;function J(){return N("document")}u.getDocument=J;function Z(){return b("navigator")}u.getNavigatorOrThrow=Z;function X(){return N("navigator")}u.getNavigator=X;function k(){return b("location")}u.getLocationOrThrow=k;function ee(){return N("location")}u.getLocation=ee;function te(){return b("crypto")}u.getCryptoOrThrow=te;function re(){return N("crypto")}u.getCrypto=re;function ne(){return b("localStorage")}u.getLocalStorageOrThrow=ne;function se(){return N("localStorage")}u.getLocalStorage=se;var P={};Object.defineProperty(P,"__esModule",{value:!0});P.getWindowMetadata=void 0;const L=u;function ie(){let o,e;try{o=L.getDocumentOrThrow(),e=L.getLocationOrThrow()}catch{return null}function i(){const p=o.getElementsByTagName("link"),I=[];for(let E=0;E<p.length;E++){const S=p[E],T=S.getAttribute("rel");if(T&&T.toLowerCase().indexOf("icon")>-1){const g=S.getAttribute("href");if(g)if(g.toLowerCase().indexOf("https:")===-1&&g.toLowerCase().indexOf("http:")===-1&&g.indexOf("//")!==0){let _=e.protocol+"//"+e.host;if(g.indexOf("/")===0)_+=g;else{const t=e.pathname.split("/");t.pop();const r=t.join("/");_+=r+"/"+g}I.push(_)}else if(g.indexOf("//")===0){const _=e.protocol+g;I.push(_)}else I.push(g)}}return I}function c(...p){const I=o.getElementsByTagName("meta");for(let E=0;E<I.length;E++){const S=I[E],T=["itemprop","property","name"].map(g=>S.getAttribute(g)).filter(g=>g?p.includes(g):!1);if(T.length&&T){const g=S.getAttribute("content");if(g)return g}}return""}function d(){let p=c("name","og:site_name","og:title","twitter:title");return p||(p=o.title),p}function m(){return c("description","og:description","twitter:description","keywords")}const y=d(),U=m(),C=e.origin,w=i();return{description:U,url:C,icons:w,name:y}}P.getWindowMetadata=ie;var ae={};(function(o){const e=K,i=Y,c=B,d=x,m=t=>t==null,y=Symbol("encodeFragmentIdentifier");function U(t){switch(t.arrayFormat){case"index":return r=>(s,n)=>{const a=s.length;return n===void 0||t.skipNull&&n===null||t.skipEmptyString&&n===""?s:n===null?[...s,[f(r,t),"[",a,"]"].join("")]:[...s,[f(r,t),"[",f(a,t),"]=",f(n,t)].join("")]};case"bracket":return r=>(s,n)=>n===void 0||t.skipNull&&n===null||t.skipEmptyString&&n===""?s:n===null?[...s,[f(r,t),"[]"].join("")]:[...s,[f(r,t),"[]=",f(n,t)].join("")];case"colon-list-separator":return r=>(s,n)=>n===void 0||t.skipNull&&n===null||t.skipEmptyString&&n===""?s:n===null?[...s,[f(r,t),":list="].join("")]:[...s,[f(r,t),":list=",f(n,t)].join("")];case"comma":case"separator":case"bracket-separator":{const r=t.arrayFormat==="bracket-separator"?"[]=":"=";return s=>(n,a)=>a===void 0||t.skipNull&&a===null||t.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[f(s,t),r,f(a,t)].join("")]:[[n,f(a,t)].join(t.arrayFormatSeparator)])}default:return r=>(s,n)=>n===void 0||t.skipNull&&n===null||t.skipEmptyString&&n===""?s:n===null?[...s,f(r,t)]:[...s,[f(r,t),"=",f(n,t)].join("")]}}function C(t){let r;switch(t.arrayFormat){case"index":return(s,n,a)=>{if(r=/\[(\d*)\]$/.exec(s),s=s.replace(/\[\d*\]$/,""),!r){a[s]=n;return}a[s]===void 0&&(a[s]={}),a[s][r[1]]=n};case"bracket":return(s,n,a)=>{if(r=/(\[\])$/.exec(s),s=s.replace(/\[\]$/,""),!r){a[s]=n;return}if(a[s]===void 0){a[s]=[n];return}a[s]=[].concat(a[s],n)};case"colon-list-separator":return(s,n,a)=>{if(r=/(:list)$/.exec(s),s=s.replace(/:list$/,""),!r){a[s]=n;return}if(a[s]===void 0){a[s]=[n];return}a[s]=[].concat(a[s],n)};case"comma":case"separator":return(s,n,a)=>{const l=typeof n=="string"&&n.includes(t.arrayFormatSeparator),h=typeof n=="string"&&!l&&p(n,t).includes(t.arrayFormatSeparator);n=h?p(n,t):n;const O=l||h?n.split(t.arrayFormatSeparator).map(V=>p(V,t)):n===null?n:p(n,t);a[s]=O};case"bracket-separator":return(s,n,a)=>{const l=/(\[\])$/.test(s);if(s=s.replace(/\[\]$/,""),!l){a[s]=n&&p(n,t);return}const h=n===null?[]:n.split(t.arrayFormatSeparator).map(O=>p(O,t));if(a[s]===void 0){a[s]=h;return}a[s]=[].concat(a[s],h)};default:return(s,n,a)=>{if(a[s]===void 0){a[s]=n;return}a[s]=[].concat(a[s],n)}}}function w(t){if(typeof t!="string"||t.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function f(t,r){return r.encode?r.strict?e(t):encodeURIComponent(t):t}function p(t,r){return r.decode?i(t):t}function I(t){return Array.isArray(t)?t.sort():typeof t=="object"?I(Object.keys(t)).sort((r,s)=>Number(r)-Number(s)).map(r=>t[r]):t}function E(t){const r=t.indexOf("#");return r!==-1&&(t=t.slice(0,r)),t}function S(t){let r="";const s=t.indexOf("#");return s!==-1&&(r=t.slice(s)),r}function T(t){t=E(t);const r=t.indexOf("?");return r===-1?"":t.slice(r+1)}function g(t,r){return r.parseNumbers&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?t=Number(t):r.parseBooleans&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")&&(t=t.toLowerCase()==="true"),t}function _(t,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),w(r.arrayFormatSeparator);const s=C(r),n=Object.create(null);if(typeof t!="string"||(t=t.trim().replace(/^[?#&]/,""),!t))return n;for(const a of t.split("&")){if(a==="")continue;let[l,h]=c(r.decode?a.replace(/\+/g," "):a,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?h:p(h,r),s(p(l,r),h,n)}for(const a of Object.keys(n)){const l=n[a];if(typeof l=="object"&&l!==null)for(const h of Object.keys(l))l[h]=g(l[h],r);else n[a]=g(l,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,l)=>{const h=n[l];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?a[l]=I(h):a[l]=h,a},Object.create(null))}o.extract=T,o.parse=_,o.stringify=(t,r)=>{if(!t)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),w(r.arrayFormatSeparator);const s=h=>r.skipNull&&m(t[h])||r.skipEmptyString&&t[h]==="",n=U(r),a={};for(const h of Object.keys(t))s(h)||(a[h]=t[h]);const l=Object.keys(a);return r.sort!==!1&&l.sort(r.sort),l.map(h=>{const O=t[h];return O===void 0?"":O===null?f(h,r):Array.isArray(O)?O.length===0&&r.arrayFormat==="bracket-separator"?f(h,r)+"[]":O.reduce(n(h),[]).join("&"):f(h,r)+"="+f(O,r)}).filter(h=>h.length>0).join("&")},o.parseUrl=(t,r)=>{r=Object.assign({decode:!0},r);const[s,n]=c(t,"#");return Object.assign({url:s.split("?")[0]||"",query:_(T(t),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:p(n,r)}:{})},o.stringifyUrl=(t,r)=>{r=Object.assign({encode:!0,strict:!0,[y]:!0},r);const s=E(t.url).split("?")[0]||"",n=o.extract(t.url),a=o.parse(n,{sort:!1}),l=Object.assign(a,t.query);let h=o.stringify(l,r);h&&(h=`?${h}`);let O=S(t.url);return t.fragmentIdentifier&&(O=`#${r[y]?f(t.fragmentIdentifier,r):t.fragmentIdentifier}`),`${s}${h}${O}`},o.pick=(t,r,s)=>{s=Object.assign({parseFragmentIdentifier:!0,[y]:!1},s);const{url:n,query:a,fragmentIdentifier:l}=o.parseUrl(t,s);return o.stringifyUrl({url:n,query:d(a,r),fragmentIdentifier:l},s)},o.exclude=(t,r,s)=>{const n=Array.isArray(r)?a=>!r.includes(a):(a,l)=>!r(a,l);return o.pick(t,n,s)}})(ae);function oe(o,e=[]){const i=[];return Object.keys(o).forEach(c=>{if(e.length&&!e.includes(c))return;const d=o[c];i.push(...d.accounts)}),i}const ce={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function he(o,e){const{message:i,code:c}=ce[o];return{message:e?`${i} ${e}`:i,code:c}}function j(o,e){return Array.isArray(o)?typeof e<"u"&&o.length?o.every(e):!0:!1}const de="wc",le="ethereum_provider",ue=`${de}@${2}:${le}:`,fe="https://rpc.walletconnect.com/v1/",R=["eth_sendTransaction","personal_sign"],Se=["eth_accounts","eth_requestAccounts","eth_call","eth_getBalance","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],M=["chainChanged","accountsChanged"],ye=["message","disconnect","connect"];var ge=Object.defineProperty,pe=Object.defineProperties,me=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable,q=(o,e,i)=>e in o?ge(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i,A=(o,e)=>{for(var i in e||(e={}))Ee.call(e,i)&&q(o,i,e[i]);if(v)for(var i of v(e))we.call(e,i)&&q(o,i,e[i]);return o},H=(o,e)=>pe(o,me(e));function F(o){return Number(o[0].split(":")[1])}function D(o){return`0x${o.toString(16)}`}function Ie(o){const{chains:e,optionalChains:i,methods:c,optionalMethods:d,events:m,optionalEvents:y,rpcMap:U}=o;if(!j(e))throw new Error("Invalid chains");const C=e,w=c||R,f=m||M,p={[F(C)]:U[F(C)]},I={chains:C,methods:w,events:f,rpcMap:p},E=m?.filter(_=>!M.includes(_)),S=c?.filter(_=>!R.includes(_));if(!i&&!y&&!d&&!(E!=null&&E.length)&&!(S!=null&&S.length))return{required:I};const T=E?.length&&S?.length||!i,g={chains:[...new Set(T?C.concat(i||[]):i)],methods:[...new Set(w.concat(d||[]))],events:[...new Set(f.concat(y||[]))],rpcMap:U};return{required:I,optional:g}}class ${constructor(){this.events=new Q.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=ue,this.on=(e,i)=>(this.events.on(e,i),this),this.once=(e,i)=>(this.events.once(e,i),this),this.removeListener=(e,i)=>(this.events.removeListener(e,i),this),this.off=(e,i)=>(this.events.off(e,i),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const i=new $;return await i.initialize(e),i}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,i){this.signer.sendAsync(e,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:c}=Ie(this.rpc);try{const d=await new Promise(async(y,U)=>{var C;this.rpc.showQrModal&&((C=this.modal)==null||C.subscribeModal(w=>{!w.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),U(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(H(A({namespaces:{[this.namespace]:i}},c&&{optionalNamespaces:{[this.namespace]:c}}),{pairingTopic:e?.pairingTopic})).then(w=>{y(w)}).catch(w=>{U(new Error(w.message))})});if(!d)return;this.setChainIds(this.rpc.chains);const m=oe(d.namespaces,[this.namespace]);this.setAccounts(m),this.events.emit("connect",{chainId:D(this.chainId)})}catch(d){throw this.signer.logger.error(d),d}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:i}=e,{event:c}=i;c.name==="accountsChanged"?(this.accounts=this.parseAccounts(c.data),this.events.emit("accountsChanged",this.accounts)):c.name==="chainChanged"?this.setChainId(this.formatChainId(c.data)):this.events.emit(c.name,c.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const i=parseInt(e);this.chainId=i,this.events.emit("chainChanged",D(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",H(A({},he("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var i,c;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(c=this.modal)==null||c.openModal({uri:e})),this.events.emit("display_uri",e)})}setHttpProvider(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const i=e.filter(c=>this.isCompatibleChainId(c)).map(c=>this.parseChainId(c));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",D(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const i=this.parseChainId(e);this.chainId=i,this.setHttpProvider(i)}}parseAccountId(e){const[i,c,d]=e.split(":");return{chainId:`${i}:${c}`,address:d}}setAccounts(e){this.accounts=e.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var i,c;return{chains:((i=e.chains)==null?void 0:i.map(d=>this.formatChainId(d)))||[`${this.namespace}:1`],optionalChains:e.optionalChains?e.optionalChains.map(d=>this.formatChainId(d)):void 0,methods:e?.methods||R,events:e?.events||M,optionalMethods:e?.optionalMethods||[],optionalEvents:e?.optionalEvents||[],rpcMap:e?.rpcMap||this.buildRpcMap(e.chains.concat(e.optionalChains||[]),e.projectId),showQrModal:Boolean(e?.showQrModal),qrModalOptions:(c=e?.qrModalOptions)!=null?c:void 0,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,i){const c={};return e.forEach(d=>{c[d]=this.getRpcUrl(d,i)}),c}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=F(this.rpc.chains),this.signer=await z.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal)try{const{Web3Modal:i}=await W(()=>import("./index-a90e6520.js").then(c=>c.i),["assets/index-a90e6520.js","assets/index-37949774.js","assets/index-d84e1bdf.css"]);this.modal=new i(A({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch{throw new Error("To use QR modal, please install @web3modal/standalone package")}}loadConnectOpts(e){if(!e)return;const{chains:i,optionalChains:c,rpcMap:d}=e;i&&j(i)&&(this.rpc.chains=i.map(m=>this.formatChainId(m)),i.forEach(m=>{this.rpc.rpcMap[m]=d?.[m]||this.getRpcUrl(m)})),c&&j(c)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=c?.map(m=>this.formatChainId(m)),c.forEach(m=>{this.rpc.rpcMap[m]=d?.[m]||this.getRpcUrl(m)}))}getRpcUrl(e,i){var c;return((c=this.rpc.rpcMap)==null?void 0:c[e])||`${fe}?chainId=eip155:${e}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`);this.setChainIds(e?[this.formatChainId(e)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(i=>this.parseAccount(i))}}const Te=$;export{Te as EthereumProvider,ye as OPTIONAL_EVENTS,Se as OPTIONAL_METHODS,M as REQUIRED_EVENTS,R as REQUIRED_METHODS,$ as default};
